# ë ˆê±°ì‹œ ê¶Œí•œ ì •ë¦¬ (specialist, editor, agency_staff)

## ğŸ“‹ ê°œìš”

ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼([008_add_admin_system.sql](supabase/migrations/008_add_admin_system.sql))ì— ëª…ì‹œëœ ëŒ€ë¡œ ë‹¤ìŒ ê¶Œí•œë“¤ì€ **ë‹¨ê³„ì ìœ¼ë¡œ ì œê±°** ì˜ˆì •:
- `specialist` (ìŠ¤í˜ì…œë¦¬ìŠ¤íŠ¸)
- `editor` (í¸ì§‘ì)
- `agency_staff` (ì—ì´ì „ì‹œ ì§ì›)

### ğŸ¯ ì²˜ë¦¬ ë°©ì¹¨

**ì£¼ì„ ì²˜ë¦¬ ë°©ì‹** (ì™„ì „ ì‚­ì œ X, í˜¸í™˜ì„± ìœ ì§€ O)
- âœ… ê¸°ì¡´ ì‚¬ìš©ì: ì •ìƒ í‘œì‹œ ë° ìˆ˜ì • ê°€ëŠ¥
- âœ… ê¶Œí•œ ê³„ì¸µ: ìœ ì§€ (ë¹„êµ ë¡œì§ ì •ìƒ ì‘ë™)
- âŒ ì‹ ê·œ í• ë‹¹: UIì—ì„œ ì„ íƒ ë¶ˆê°€
- âš ï¸ í–¥í›„ ê³„íš: DB ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ì™„ì „ ì‚­ì œ

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### [EditUserModal.jsx](src/views/admin/users/components/EditUserModal.jsx)

#### 1. `roleHierarchy` - ë ˆê±°ì‹œ ê¶Œí•œ ìœ ì§€ + ê²½ê³  ì£¼ì„
```javascript
const roleHierarchy = {
  specialist: 7.5,   // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ (UI ì„ íƒ ë¶ˆê°€)
  agency_admin: 7,
  agency_manager: 6,
  agency_staff: 5,   // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ (UI ì„ íƒ ë¶ˆê°€)
  advertiser_admin: 4,
  advertiser_staff: 3,
  editor: 2,         // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ (UI ì„ íƒ ë¶ˆê°€)
  viewer: 1,
};
```

#### 2. `getRoleLabel` - ë ˆê±°ì‹œ ê¶Œí•œ ë¼ë²¨ ìœ ì§€ + ê²½ê³  ì£¼ì„
```javascript
const roleLabels = {
  master: 'ë§ˆìŠ¤í„°',
  specialist: 'ìŠ¤í˜ì…œë¦¬ìŠ¤íŠ¸',    // âš ï¸ ì‚­ì œ ì˜ˆì •
  agency_admin: 'ì—ì´ì „ì‹œ ëŒ€í‘œ',
  agency_manager: 'ì—ì´ì „ì‹œ ê´€ë¦¬ì',
  agency_staff: 'ì—ì´ì „ì‹œ ì§ì›',  // âš ï¸ ì‚­ì œ ì˜ˆì •
  advertiser_admin: 'ë¸Œëœë“œ ëŒ€í‘œìš´ì˜ì',
  advertiser_staff: 'ë¸Œëœë“œ ë¶€ìš´ì˜ì',
  editor: 'í¸ì§‘ì',              // âš ï¸ ì‚­ì œ ì˜ˆì •
  viewer: 'ë·°ì–´',
};
```

#### 3. `canAssignRole` - ë ˆê±°ì‹œ ê¶Œí•œ ì„ íƒ ì°¨ë‹¨
```javascript
// âš ï¸ ë ˆê±°ì‹œ ê¶Œí•œì€ UIì—ì„œ ì„ íƒ ë¶ˆê°€ (ê¸°ì¡´ ì‚¬ìš©ì í˜¸í™˜ì„±ë§Œ ìœ ì§€)
if (['specialist', 'editor', 'agency_staff'].includes(targetRole)) {
  return false;
}
```

#### 4. UI ë©”ë‰´ - ì£¼ì„ ì²˜ë¦¬ (í‘œì‹œ ì•ˆ í•¨)
```javascript
{/* âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ (UIì—ì„œ ì„ íƒ ë¶ˆê°€)
  <MenuItem onClick={() => handleRoleChange('editor')}>
    ...
  </MenuItem>
*/}
```

#### 5. `BRAND_ROLES` - editor ì œì™¸
```javascript
const BRAND_ROLES = [
  'viewer',
  // 'editor',  // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  'advertiser_admin',
  'advertiser_staff'
];
```

**âœ… íš¨ê³¼**: ê¸°ì¡´ ì‚¬ìš©ì ì •ìƒ í‘œì‹œ/ìˆ˜ì •, ì‹ ê·œ í• ë‹¹ ì°¨ë‹¨

---

## âš ï¸ ì¶”ê°€ ì‘ì—… í•„ìš”í•œ íŒŒì¼ë“¤

### 1. Frontend íŒŒì¼

#### ğŸ“„ `src/views/superadmin/permissions/components/PermissionTable.js`
**ìœ„ì¹˜**: ë¼ì¸ 96, 99, 224, 227, 230
**ì‘ì—… ë‚´ìš©**: EditUserModalê³¼ ë™ì¼í•˜ê²Œ ì£¼ì„ ì²˜ë¦¬ ë°©ì‹ ì ìš©

```javascript
const roleHierarchy = {
  specialist: 7.5,   // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  agency_admin: 7,
  agency_manager: 6,
  agency_staff: 5,   // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  advertiser_admin: 4,
  advertiser_staff: 3,
  editor: 2,         // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  viewer: 1,
};

const roleMap = {
  master: 'ë§ˆìŠ¤í„°',
  specialist: 'ìŠ¤í˜ì…œë¦¬ìŠ¤íŠ¸',    // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  agency_admin: 'ì—ì´ì „ì‹œ ëŒ€í‘œ',
  agency_manager: 'ì—ì´ì „ì‹œ ê´€ë¦¬ì',
  agency_staff: 'ì—ì´ì „ì‹œ ì§ì›',  // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  advertiser_admin: 'ë¸Œëœë“œ ëŒ€í‘œìš´ì˜ì',
  advertiser_staff: 'ë¸Œëœë“œ ë¶€ìš´ì˜ì',
  editor: 'í¸ì§‘ì',              // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  viewer: 'ë·°ì–´',
};
```

#### ğŸ“„ `src/views/admin/users/components/UserTable.js`
**ìœ„ì¹˜**: ë¼ì¸ 284, 287
**ì‘ì—… ë‚´ìš©**: ë ˆê±°ì‹œ ê¶Œí•œ ìœ ì§€ + ê²½ê³  ì£¼ì„

```javascript
const roleConfig = {
  agency_admin: { label: 'ì—ì´ì „ì‹œ ëŒ€í‘œ', color: 'purple' },
  agency_manager: { label: 'ì—ì´ì „ì‹œ ê´€ë¦¬ì', color: 'purple' },
  agency_staff: { label: 'ì—ì´ì „ì‹œ ì§ì›', color: 'purple' },  // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  advertiser_admin: { label: 'ë¸Œëœë“œ ëŒ€í‘œìš´ì˜ì', color: 'blue' },
  advertiser_staff: { label: 'ë¸Œëœë“œ ë¶€ìš´ì˜ì', color: 'cyan' },
  editor: { label: 'í¸ì§‘ì', color: 'green' },  // âš ï¸ ì‚­ì œ ì˜ˆì • - ë ˆê±°ì‹œ ê¶Œí•œ
  viewer: { label: 'ë·°ì–´', color: 'gray' },
};
```

#### ğŸ“„ `src/services/supabaseService.js`
**ìœ„ì¹˜**: ë¼ì¸ 370
**ì‘ì—… ë‚´ìš©**: agency_staffëŠ” ìœ ì§€í•˜ë˜ ì£¼ì„ìœ¼ë¡œ í‘œì‹œ

```javascript
// âš ï¸ agency_staffëŠ” ë ˆê±°ì‹œ ê¶Œí•œì´ì§€ë§Œ í•„í„° ìœ ì§€ (ê¸°ì¡´ ì‚¬ìš©ì í˜¸í™˜ì„±)
.not('role', 'in', '(master,agency_staff,agency_admin,agency_manager)')
```

---

### 2. Backend/Database íŒŒì¼

#### ğŸ“„ `supabase/migrations/020_add_user_update_permission_function.sql`
**ì‘ì—… ë‚´ìš©**:
- specialist, editor, agency_staff ê´€ë ¨ ë¡œì§ í™•ì¸
- ì£¼ì„ ì²˜ë¦¬ ë˜ëŠ” ì¡°ê±´ ì¶”ê°€

#### ğŸ“„ `supabase/functions/delete-user/index.ts`
**ì‘ì—… ë‚´ìš©**:
- editor, agency_staff ê´€ë ¨ ë¡œì§ í™•ì¸
- ì£¼ì„ ì²˜ë¦¬ ë˜ëŠ” ì¡°ê±´ ì¶”ê°€

---

### 3. ê¸°íƒ€ í™•ì¸ í•„ìš” íŒŒì¼

ë‹¤ìŒ íŒŒì¼ë“¤ì€ 'editor'ê°€ í…ìŠ¤íŠ¸ í¸ì§‘ê¸° ì˜ë¯¸ë¡œ ì‚¬ìš©ë  ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë¯€ë¡œ ìˆ˜ë™ ê²€í† :
- `src/views/admin/profile/index.jsx`
- `src/views/admin/profile/components/OwnershipTransferModal.js`
- `src/views/admin/profile/components/BrandsList.js`
- `src/views/auth/signUp/components/InviteSignUpForm.jsx`
- `src/views/clientadmin/brands/components/BrandCard.jsx`

---

## ğŸ” ê²€ì¦ ë°©ë²•

### 1. ì½”ë“œ ê²€ìƒ‰
```bash
# ads-library í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰

# specialist ê²€ìƒ‰
grep -r "specialist" src/ supabase/ --exclude-dir=node_modules

# editor ê²€ìƒ‰ (ê¶Œí•œìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ë§Œ)
grep -r "'editor'" src/ supabase/ --exclude-dir=node_modules
grep -r '"editor"' src/ supabase/ --exclude-dir=node_modules

# agency_staff ê²€ìƒ‰
grep -r "agency_staff" src/ supabase/ --exclude-dir=node_modules
```

### 2. DB ë°ì´í„° í™•ì¸
```sql
-- ë ˆê±°ì‹œ ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ì ì¡°íšŒ
SELECT
  id,
  email,
  name,
  role,
  created_at
FROM users
WHERE role IN ('specialist', 'editor', 'agency_staff')
  AND deleted_at IS NULL
ORDER BY role, created_at DESC;
```

---

## ğŸ“‹ ì‘ì—… ìˆœì„œ (ê¶Œì¥)

1. **âœ… EditUserModal.jsx** (ì™„ë£Œ)
2. **PermissionTable.js** - ê¶Œí•œ í…Œì´ë¸” í‘œì‹œ
3. **UserTable.js** - ì‚¬ìš©ì ëª©ë¡ í‘œì‹œ
4. **supabaseService.js** - ì„œë¹„ìŠ¤ ë¡œì§
5. **Database í•¨ìˆ˜** - SQL í•¨ìˆ˜ ë° ë§ˆì´ê·¸ë ˆì´ì…˜
6. **Edge Functions** - Supabase Edge Functions
7. **ìµœì¢… ê²€ì¦** - ì½”ë“œ ê²€ìƒ‰ + DB ë°ì´í„° í™•ì¸

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„° ë³´í˜¸
- DBì—ì„œ ë ˆê±°ì‹œ ê¶Œí•œ ì‚¬ìš©ì ìˆ˜ í™•ì¸ í•„ìˆ˜
- ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš ìˆ˜ë¦½ í›„ ì§„í–‰
- ë°±ì—… í•„ìˆ˜!

### 2. ê¶Œí•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œë‚˜ë¦¬ì˜¤
```
specialist â†’ agency_admin ë˜ëŠ” advertiser_admin
editor â†’ viewer ë˜ëŠ” advertiser_staff
agency_staff â†’ agency_manager ë˜ëŠ” ì œê±°
```

### 3. RLS ì •ì±… ê²€í† 
```sql
-- RLS ì •ì±…ì—ì„œ ë ˆê±°ì‹œ ê¶Œí•œ ì°¸ì¡° ì—¬ë¶€ í™•ì¸
SELECT
  schemaname,
  tablename,
  policyname,
  definition
FROM pg_policies
WHERE definition LIKE '%specialist%'
   OR definition LIKE '%editor%'
   OR definition LIKE '%agency_staff%';
```

### 4. ì™„ì „ ì‚­ì œ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] DBì— ë ˆê±°ì‹œ ê¶Œí•œ ì‚¬ìš©ì 0ëª…
- [ ] ëª¨ë“  ì½”ë“œ íŒŒì¼ ì£¼ì„ ì²˜ë¦¬ ì™„ë£Œ
- [ ] RLS ì •ì±…ì—ì„œ ì œê±° ì™„ë£Œ
- [ ] Edge Functions ì—…ë°ì´íŠ¸ ì™„ë£Œ
- [ ] í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

## ğŸš€ í–¥í›„ ê³„íš

1. **Phase 1** (í˜„ì¬): ì£¼ì„ ì²˜ë¦¬ + ì‹ ê·œ í• ë‹¹ ì°¨ë‹¨
2. **Phase 2**: DB ì‚¬ìš©ì ê¶Œí•œ ë§ˆì´ê·¸ë ˆì´ì…˜
3. **Phase 3**: ì½”ë“œì—ì„œ ì™„ì „ ì œê±°
4. **Phase 4**: DB enum/constraint ì—…ë°ì´íŠ¸
